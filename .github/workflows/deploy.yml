name: Deploy to Firebase Functions

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy Functions
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Setup Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: |
          cd functions
          npm ci
      
      - name: Create service account file
        run: echo '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}' > $HOME/gcloud-service-key.json
      
      - name: Deploy to Firebase
        run: |
          npm install -g firebase-tools
          export GOOGLE_APPLICATION_CREDENTIALS="$HOME/gcloud-service-key.json"
          firebase deploy --only functions --project albourakh-sn-ok
```

---

### **Ã‰tape 5 : Commit le fichier**

Descendez en bas de la page. Vous verrez une section **"Commit new file"**.

**Remplissez** :

1. **Premier champ** (titre du commit) :
```
   feat: Add automatic Firebase deployment
```

2. **DeuxiÃ¨me champ** (description - optionnel) :
```
   Configure GitHub Actions to automatically deploy Cloud Functions
```

3. **SÃ©lectionnez** : 
   - âœ… **"Commit directly to the main branch"** (dÃ©jÃ  sÃ©lectionnÃ© par dÃ©faut)

4. **Cliquez sur le bouton vert** : **"Commit new file"**

---

## ğŸ‰ **LE DÃ‰PLOIEMENT VA DÃ‰MARRER AUTOMATIQUEMENT !**

DÃ¨s que vous cliquez sur "Commit new file", GitHub Actions va se lancer !

---

## ğŸ“Š **Ã‰TAPE 6 : VOIR LE DÃ‰PLOIEMENT EN COURS**

### **ImmÃ©diatement aprÃ¨s le commit :**

1. **Cliquez sur l'onglet "Actions"** (en haut de votre repo)
```
   Code    Issues    Pull requests    Actions    Projects
                                         â†‘
                                    CLIQUEZ ICI
```

2. Vous verrez un workflow en cours :
```
   ğŸŸ¡ Deploy to Firebase Functions
      feat: Add automatic Firebase deployment
      #1: Commit abc123... by [votre-nom]
      Running... 2s ago
```

3. **Cliquez sur ce workflow** pour voir les dÃ©tails

---

## ğŸ“º **VOIR LES LOGS EN TEMPS RÃ‰EL**

Une fois dans le workflow, vous verrez plusieurs Ã©tapes :
```
âœ… Set up job
ğŸ”µ Checkout code (en cours)
â³ Setup Node.js 18
â³ Install dependencies
â³ Create service account file
â³ Deploy to Firebase
```

Les Ã©tapes en cours seront en **bleu** ğŸ”µ  
Les Ã©tapes terminÃ©es seront en **vert** âœ…

---

## â±ï¸ **DURÃ‰E DU DÃ‰PLOIEMENT**
```
T+0s      â†’ Commit du fichier
T+10s     â†’ GitHub Actions dÃ©marre
T+20s     â†’ âœ… Checkout code
T+30s     â†’ âœ… Setup Node.js
T+1min    â†’ âœ… Install dependencies
T+2min    â†’ ğŸ”µ Deploy to Firebase (en cours)
T+3-4min  â†’ âœ… DEPLOY COMPLETE !
```

---

## ğŸ¯ **RÃ‰SULTAT ATTENDU**

AprÃ¨s 3-4 minutes, vous verrez :
```
âœ… Deploy to Firebase Functions
   All checks have passed
   
âœ… Set up job
âœ… Checkout code
âœ… Setup Node.js 18
âœ… Install dependencies
âœ… Create service account file
âœ… Deploy to Firebase
   
   âœ”  functions[crediterChauffeurAutomatique]: Successful create operation.
   âœ”  functions[recupererCreditsManques]: Successful create operation.
   âœ”  Deploy complete!
```

---

## ğŸ‰ **VÃ‰RIFICATION FINALE**

AprÃ¨s le succÃ¨s du dÃ©ploiement, allez sur :

**Firebase Console** â†’ **Functions** :
```
https://console.firebase.google.com/project/albourakh-sn-ok/functions
